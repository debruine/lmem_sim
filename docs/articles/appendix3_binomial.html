<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Appendix 3: Binomial Example • lmem.sim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Appendix 3: Binomial Example">
<meta property="og:description" content="lmem.sim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lmem.sim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/appendix1_example_code.html">Appendix 1: Example Code</a>
    </li>
    <li>
      <a href="../articles/appendix1b_example_code.html">Appendix 1b: Example Code (no tidyverse)</a>
    </li>
    <li>
      <a href="../articles/appendix1c_sensitivity.html">Appendix 1c: Sensitivity Analysis</a>
    </li>
    <li>
      <a href="../articles/appendix2_extended_example.html">Appendix 2: Extended Example</a>
    </li>
    <li>
      <a href="../articles/appendix3_binomial.html">Appendix 3: Binomial Example</a>
    </li>
    <li>
      <a href="../articles/appendix3b_extended_binomial.html">Appendix 3b: Extended Binomial Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="appendix3_binomial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Appendix 3: Binomial Example</h1>
            <h3 class="subtitle">Understanding mixed effects models through data simulation</h3>
                        <h4 class="author">Lisa M. DeBruine &amp; Dale J. Barr</h4>
            
      
      
      <div class="hidden name"><code>appendix3_binomial.Rmd</code></div>

    </div>

    
    
<p><a href="https://github.com/debruine/lmem_sim/blob/master/vignettes/appendix3_binomial.Rmd">Download the .Rmd for this example</a></p>
<div id="simulating-binomial-data-with-crossed-random-factors" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-binomial-data-with-crossed-random-factors" class="anchor"></a>Simulating binomial data with crossed random factors</h2>
<p>To give an overview of the simulation task, we will simulate data from a design with crossed random factors of subjects and stimuli, fit a model to the simulated data, and then try to recover the parameter values we put in from the output. In this hypothetical study, subjects classify the emotional expressions of faces as quickly as possible, and we use accuracy (correct/incorrect) as the primary dependent variable. The faces are of two types: either from the subject’s ingroup or from an outgroup. For simplicity, we further assume that each face appears only once in the stimulus set. The key question is whether there is any difference in classification accuracy across the type of face.</p>
<p>The important parts of the design are:</p>
<ul>
<li>Random factor 1: subjects (associated variables will be prefixed by T, <span class="math inline">\(\tau\)</span>, or <code>tau</code>)</li>
<li>Random factor 2: faces (associated variables will be prefixed by O, <span class="math inline">\(\omega\)</span>, or <code>omega</code>)</li>
<li>Fixed factor 1: category (level = ingroup, outgroup)
<ul>
<li>within subject: subjects see both ingroup and outgroup faces</li>
<li>between face: faces are either ingroup or outgroup</li>
</ul>
</li>
</ul>
<div id="required-software" class="section level3">
<h3 class="hasAnchor">
<a href="#required-software" class="anchor"></a>Required software</h3>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># load required packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"lme4"</span>)        <span class="co"># model specification / estimation</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"afex"</span>)        <span class="co"># anova and deriving p-values from lmer</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"broom.mixed"</span>) <span class="co"># extracting data from model fits </span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"faux"</span>)        <span class="co"># data simulation</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"tidyverse"</span>)   <span class="co"># data wrangling and visualisation</span>

<span class="co"># ensure this script returns the same results on each run</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">8675309</span>)
<span class="fu"><a href="https://rdrr.io/pkg/faux/man/faux_options.html">faux_options</a></span>(<span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>This example presents a simulation for a binomial logistic mixed regression. Part of the process involves conversion between probability and the logit function of probability. The code below converts between these.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">logit</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) { <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">x</span> / (<span class="fl">1</span> - <span class="no">x</span>)) }
<span class="no">inv_logit</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) { <span class="fl">1</span> / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">x</span>)) }

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">.01</span>)
) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">logit</span> <span class="kw">=</span> <span class="fu">logit</span>(<span class="no">prob</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="no">prob</span>, <span class="no">logit</span>)) +
  <span class="fu">geom_point</span>()</pre></body></html></div>
<p><img src="appendix3_binomial_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
</div>
<div id="data-simulation-function" class="section level3">
<h3 class="hasAnchor">
<a href="#data-simulation-function" class="anchor"></a>Data simulation function</h3>
<p>The data generating process is slighly different for binomial logistic regression. The random effects and their correlations are set the same way as for a gaussian model (you’ll need some pilot data to estimate reasonable parameters), but we don’t need an error term.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># set up the custom data simulation function</span>
<span class="no">my_bin_data</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(
  <span class="no">n_subj</span>     <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># number of subjects</span>
  <span class="no">n_ingroup</span>  <span class="kw">=</span>  <span class="fl">25</span>,  <span class="co"># number of faces in ingroup</span>
  <span class="no">n_outgroup</span> <span class="kw">=</span>  <span class="fl">25</span>,  <span class="co"># number of faces in outgroup</span>
  <span class="no">beta_0</span>     <span class="kw">=</span>   <span class="fl">0</span>, <span class="co"># intercept</span>
  <span class="no">beta_1</span>     <span class="kw">=</span>   <span class="fl">0</span>, <span class="co"># effect of category</span>
  <span class="no">omega_0</span>    <span class="kw">=</span>   <span class="fl">1</span>, <span class="co"># by-item random intercept sd</span>
  <span class="no">tau_0</span>      <span class="kw">=</span>   <span class="fl">1</span>, <span class="co"># by-subject random intercept sd</span>
  <span class="no">tau_1</span>      <span class="kw">=</span>   <span class="fl">1</span>, <span class="co"># by-subject random slope sd</span>
  <span class="no">rho</span>        <span class="kw">=</span>   <span class="fl">0</span> <span class="co"># correlation between intercept and slope</span>
                        ) {
   <span class="co"># simulate a sample of items</span>
  <span class="no">items</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="kw">item_id</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">n_ingroup</span> + <span class="no">n_outgroup</span>),
    <span class="kw">category</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ingroup"</span>, <span class="st">"outgroup"</span>),
                   <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">n_ingroup</span>, <span class="no">n_outgroup</span>)),
    <span class="kw">O_0i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_ingroup</span> + <span class="no">n_outgroup</span>, <span class="fl">0</span>, <span class="no">omega_0</span>)
  )

  <span class="co"># effect code category</span>
  <span class="no">items</span>$<span class="no">X_i</span> <span class="kw">&lt;-</span> <span class="fu">recode</span>(<span class="no">items</span>$<span class="no">category</span>,
                      <span class="st">"ingroup"</span> <span class="kw">=</span> -<span class="fl">0.5</span>,
                      <span class="st">"outgroup"</span> <span class="kw">=</span> <span class="fl">0.5</span>)

  <span class="co"># simulate a sample of subjects</span>
  <span class="no">subjects</span> <span class="kw">&lt;-</span> <span class="kw pkg">faux</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/faux/man/rnorm_multi.html">rnorm_multi</a></span>(
    <span class="kw">n</span> <span class="kw">=</span> <span class="no">n_subj</span>,
    <span class="kw">mu</span> <span class="kw">=</span> <span class="fl">0</span>,
    <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">tau_0</span>, <span class="no">tau_1</span>),
    <span class="kw">r</span> <span class="kw">=</span> <span class="no">rho</span>,
    <span class="kw">varnames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"T_0s"</span>, <span class="st">"T_1s"</span>)
  )
  <span class="no">subjects</span>$<span class="no">subj_id</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="no">n_subj</span>

  <span class="co"># cross subject and item IDs </span>
  <span class="fu">crossing</span>(<span class="no">subjects</span>, <span class="no">items</span>)  <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(
      <span class="co"># calculate gaussian DV</span>
      <span class="kw">Y</span> <span class="kw">=</span> <span class="no">beta_0</span> + <span class="no">T_0s</span> + <span class="no">O_0i</span> + (<span class="no">beta_1</span> + <span class="no">T_1s</span>) * <span class="no">X_i</span>,
      <span class="kw">pr</span> <span class="kw">=</span> <span class="fu">inv_logit</span>(<span class="no">Y</span>), <span class="co"># transform to probability of getting 1</span>
      <span class="kw">Y_bin</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">.</span>), <span class="fl">1</span>, <span class="no">pr</span>) <span class="co"># sample from bernoulli distribution</span>
    ) <span class="kw">%&gt;%</span>
    <span class="fu">select</span>(<span class="no">subj_id</span>, <span class="no">item_id</span>, <span class="no">category</span>, <span class="no">X_i</span>, <span class="no">Y</span>, <span class="no">Y_bin</span>)
}</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">dat_sim</span> <span class="kw">&lt;-</span> <span class="fu">my_bin_data</span>()
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dat_sim</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 6
##   subj_id item_id category   X_i      Y Y_bin
##     &lt;int&gt;   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
## 1      63       1 ingroup   -0.5 -3.60      0
## 2      63       2 ingroup   -0.5 -1.88      0
## 3      63       3 ingroup   -0.5 -3.22      0
## 4      63       4 ingroup   -0.5 -0.576     0
## 5      63       5 ingroup   -0.5 -1.54      0
## 6      63       6 ingroup   -0.5 -1.62      0</code></pre>
</div>
<div id="power-function" class="section level3">
<h3 class="hasAnchor">
<a href="#power-function" class="anchor"></a>Power function</h3>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">single_run</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">filename</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">...</span>) {
  <span class="co"># ... is a shortcut that forwards any arguments to my_sim_data()</span>
  <span class="no">dat_sim</span> <span class="kw">&lt;-</span> <span class="fu">my_bin_data</span>(<span class="no">...</span>)
  <span class="no">mod_sim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span>(<span class="no">Y_bin</span> ~ <span class="fl">1</span> + <span class="no">X_i</span> + (<span class="fl">1</span> <span class="kw">|</span> <span class="no">item_id</span>) + (<span class="fl">1</span> + <span class="no">X_i</span> <span class="kw">|</span> <span class="no">subj_id</span>),
                <span class="kw">data</span> <span class="kw">=</span> <span class="no">dat_sim</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="st">"binomial"</span>)

  <span class="no">sim_results</span> <span class="kw">&lt;-</span> <span class="kw pkg">broom.mixed</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/broom.mixed/man/reexports.html">tidy</a></span>(<span class="no">mod_sim</span>)

  <span class="co"># append the results to a file if filename is set</span>
  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">filename</span>)) {
    <span class="no">append</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">filename</span>) <span class="co"># append if the file exists</span>
    <span class="fu">write_csv</span>(<span class="no">sim_results</span>, <span class="no">filename</span>, <span class="kw">append</span> <span class="kw">=</span> <span class="no">append</span>)
  }

  <span class="co"># return the tidy table</span>
  <span class="no">sim_results</span>
}</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># run one model with default parameters</span>
<span class="fu">single_run</span>()</pre></body></html></div>
<pre><code>## # A tibble: 6 x 7
##   effect   group   term                 estimate std.error statistic p.value
##   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 fixed    &lt;NA&gt;    (Intercept)           -0.0343     0.166    -0.207   0.836
## 2 fixed    &lt;NA&gt;    X_i                    0.0670     0.292     0.230   0.818
## 3 ran_pars subj_id sd__(Intercept)        0.942     NA        NA      NA    
## 4 ran_pars subj_id cor__(Intercept).X_i  -0.0466    NA        NA      NA    
## 5 ran_pars subj_id sd__X_i                1.01      NA        NA      NA    
## 6 ran_pars item_id sd__(Intercept)        0.938     NA        NA      NA</code></pre>
<p>The following function converts probabilities of getting a 1 in the first and second category levels into beta values. You will need to figure out a custom function for each design to do this, or estimate fixed effect parameters from analysis of pilot data.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">prob2param</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">a</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="no">b</span> <span class="kw">=</span> <span class="fl">0</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">beta_0</span> <span class="kw">=</span> (<span class="fu">logit</span>(<span class="no">a</span>) + <span class="fu">logit</span>(<span class="no">b</span>))/<span class="fl">2</span>,
    <span class="kw">beta_1</span> <span class="kw">=</span> <span class="fu">logit</span>(<span class="no">a</span>) - <span class="fu">logit</span>(<span class="no">b</span>)
  )
}</pre></body></html></div>
<p>To get an accurate estimation of power, you need to run the simulation many times. We use 20 here as an example because the analysis is very slow, but your results are more accurate the more replications you run. This will depend on the specifics of your analysis, but we recommend at least 1000 replications.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># run simulations and save to a file on each rep</span>
<span class="no">filename</span> <span class="kw">&lt;-</span> <span class="st">"sims/binomial.csv"</span>
<span class="no">reps</span> <span class="kw">&lt;-</span> <span class="fl">20</span>
<span class="no">b</span> <span class="kw">&lt;-</span> <span class="fu">prob2param</span>(<span class="fl">.4</span>, <span class="fl">.6</span>)
<span class="no">tau_0</span>    <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">tau_1</span>    <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">omega_0</span>  <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">rho</span>      <span class="kw">&lt;-</span> <span class="fl">0.5</span>

<span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">filename</span>)) {
  <span class="co"># run simulations and save to a file</span>
  <span class="no">sims</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(<span class="fl">1</span>:<span class="no">reps</span>, ~<span class="fu">single_run</span>(
    <span class="kw">filename</span> <span class="kw">=</span> <span class="no">filename</span>,
    <span class="kw">beta_0</span>   <span class="kw">=</span> <span class="no">b</span>$<span class="no">beta_0</span>,
    <span class="kw">beta_1</span>   <span class="kw">=</span> <span class="no">b</span>$<span class="no">beta_1</span>,
    <span class="kw">tau_0</span>    <span class="kw">=</span> <span class="no">tau_0</span>,
    <span class="kw">tau_1</span>    <span class="kw">=</span> <span class="no">tau_1</span>,
    <span class="kw">omega_0</span>  <span class="kw">=</span> <span class="no">omega_0</span>,
    <span class="kw">rho</span>      <span class="kw">=</span> <span class="fl">0.5</span>)
  )
}

<span class="co"># read saved simulation data</span>
<span class="no">ct</span> <span class="kw">&lt;-</span> <span class="fu">cols</span>(<span class="co"># makes sure plots display in this order</span>
           <span class="kw">group</span> <span class="kw">=</span> <span class="fu">col_factor</span>(<span class="kw">ordered</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
           <span class="kw">term</span> <span class="kw">=</span> <span class="fu">col_factor</span>(<span class="kw">ordered</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="no">sims</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="no">filename</span>, <span class="kw">col_types</span> <span class="kw">=</span> <span class="no">ct</span>)</pre></body></html></div>
</div>
<div id="calculate-mean-estimates-and-cell-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-mean-estimates-and-cell-probabilities" class="anchor"></a>Calculate mean estimates and cell probabilities</h3>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">est</span> <span class="kw">&lt;-</span> <span class="no">sims</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">group</span>, <span class="no">term</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(
    <span class="kw">mean_estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>),
    <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">"drop"</span>
  )

<span class="no">int_est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">est</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">group</span>), <span class="no">term</span> <span class="kw">==</span> <span class="st">"(Intercept)"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pull</span>(<span class="no">mean_estimate</span>)
<span class="no">cat_est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">est</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">group</span>), <span class="no">term</span> <span class="kw">==</span> <span class="st">"X_i"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pull</span>(<span class="no">mean_estimate</span>)

<span class="no">pr0</span> <span class="kw">&lt;-</span> <span class="fu">inv_logit</span>(<span class="no">int_est</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">2</span>)
<span class="no">pr1_plus</span> <span class="kw">&lt;-</span> <span class="fu">inv_logit</span>(<span class="no">int_est</span> + <span class="fl">.5</span>*<span class="no">cat_est</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">2</span>)
<span class="no">pr1_minus</span> <span class="kw">&lt;-</span> <span class="fu">inv_logit</span>(<span class="no">int_est</span> - <span class="fl">.5</span>*<span class="no">cat_est</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fl">2</span>)

<span class="no">est</span> <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">group</span>), <span class="no">group</span>, <span class="no">term</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
  <span class="kw">sim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">b</span>$<span class="no">beta_0</span>, <span class="no">b</span>$<span class="no">beta_1</span>, <span class="no">omega_0</span>, <span class="no">rho</span>, <span class="no">tau_0</span>, <span class="no">tau_1</span>),
  <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">pr0</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">pr1_minus</span>, <span class="st">":"</span>, <span class="no">pr1_plus</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">NA</span>, <span class="fl">4</span>))
) <span class="kw">%&gt;%</span>
  <span class="fu">mutate_if</span>(<span class="no">is.numeric</span>, <span class="no">round</span>, <span class="fl">2</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 5
##   group   term                 mean_estimate   sim prob    
##   &lt;ord&gt;   &lt;ord&gt;                        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1 &lt;NA&gt;    (Intercept)                  -0.04  0    0.49    
## 2 &lt;NA&gt;    X_i                          -0.86 -0.81 0.6:0.39
## 3 subj_id sd__(Intercept)               1.02  1    &lt;NA&gt;    
## 4 subj_id cor__(Intercept).X_i          0.5   0.5  &lt;NA&gt;    
## 5 subj_id sd__X_i                       1.02  1    &lt;NA&gt;    
## 6 item_id sd__(Intercept)               0.99  1    &lt;NA&gt;</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lisa DeBruine, Dale Barr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
