<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Appendix 2: Extended Example â€¢ lmem.sim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Appendix 2: Extended Example">
<meta property="og:description" content="lmem.sim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lmem.sim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/appendix1_example_code.html">Appendix 1: Example Code</a>
    </li>
    <li>
      <a href="../articles/appendix1b_example_code.html">Appendix 1b: Example Code (no tidyverse)</a>
    </li>
    <li>
      <a href="../articles/appendix1c_sensitivity.html">Appendix 1c: Sensitivity Analysis</a>
    </li>
    <li>
      <a href="../articles/appendix2_extended_example.html">Appendix 2: Extended Example</a>
    </li>
    <li>
      <a href="../articles/appendix3_binomial.html">Appendix 3: Binomial Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="appendix2_extended_example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Appendix 2: Extended Example</h1>
            <h3 class="subtitle">Understanding mixed effects models through data simulation</h3>
                        <h4 class="author">Lisa M. DeBruine &amp; Dale J. Barr</h4>
            
      
      
      <div class="hidden name"><code>appendix2_extended_example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"lme4"</span>)        <span class="co"># model specification / estimation</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"afex"</span>)        <span class="co"># deriving p-values from lmer</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"broom.mixed"</span>) <span class="co"># extracting data from model fits </span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"faux"</span>)        <span class="co"># data simulation</span>
<span class="co"># NOTE: to install the 'faux' package, use:</span>
<span class="co"># devtools::install_github("debruine/faux", build_vignettes = TRUE)</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"tidyverse"</span>)   <span class="co"># data wrangling and visualisation</span>

<span class="co"># set options for display in this R Markdown file</span>
<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span>$<span class="fu">set</span>(<span class="kw">echo</span>       <span class="kw">=</span> <span class="fl">TRUE</span>,
                      <span class="kw">fig.width</span>  <span class="kw">=</span> <span class="fl">8</span>,
                      <span class="kw">fig.height</span> <span class="kw">=</span> <span class="fl">5</span>,
                      <span class="kw">out.width</span>  <span class="kw">=</span> <span class="st">"100%"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">90210</span>)</pre></body></html></div>
<p>This script uses the <code><a href="https://rdrr.io/pkg/faux/man/sim_design.html">sim_design()</a></code> function in <a href="https://debruine.github.io/faux/">faux</a> to create data tables with correlated random effects with specified parameters without needing to set up the correlation and variance matrices manually.</p>
<div id="set-study-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#set-study-parameters" class="anchor"></a>Set Study Parameters</h3>
<p>In this example, 100 subjects will respond twice (for happy and angry expressions) to 50 items; 25 items in each of 2 categories. In this example, <code>expression</code> is a within-subject and within-item factor and <code>category</code> is a within-subject and between-item factor.</p>
<p>We will set our grand intercept and the fixed effect of category the same as before (800 ms and 50ms). We will predict that classification speed will be faster for angry than happy outgroup faces, and faster for happy than angry ingroup faces. In other words, the effect of category will be bigger for happy faces than angry faces, but there will be no main effect of expression, just an interaction between category and expression, which we will set at 70 ms (the 50ms effect of category will be 35 ms bigger for happy faces and 35 ms smaller for angry faces).</p>
<p>Therefore, you will need to set up more complicated random effect parameters. Items and subjects will need standard deviations assigned for their random intercepts and the random slopes for any within factors (and their interactions), plus the correlations among all these SDs.</p>
<p>Since all subjects respond to all items, we can set up a table of trials by crossing the subject IDs with the item IDs and also any factors that are within-subject <em>and</em> within-item (i., <code>expression = c("happy", "angry")</code>). This is set up as a factor with the levels specified so they are displayed in the right order in plots.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ext_sim_data</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(
  <span class="no">nsubj</span>        <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># number of subjects/btwn-grp</span>
  <span class="no">nitem</span>        <span class="kw">=</span>  <span class="fl">25</span>, <span class="co"># number of items/btwn-grp</span>
  <span class="no">b0</span>           <span class="kw">=</span> <span class="fl">800</span>, <span class="co"># grand mean</span>
  <span class="no">b_cat</span>        <span class="kw">=</span>  <span class="fl">50</span>, <span class="co"># main effect of category</span>
  <span class="no">b_exp</span>        <span class="kw">=</span>   <span class="fl">0</span>, <span class="co"># main effect of expression</span>
  <span class="no">b_cat_exp</span>    <span class="kw">=</span>  <span class="fl">70</span>, <span class="co"># interaction between category and expression</span>
  <span class="no">I0i_sd</span>       <span class="kw">=</span>  <span class="fl">80</span>, <span class="co"># by-item random intercept sd</span>
  <span class="no">Iexp_sd</span>      <span class="kw">=</span>  <span class="fl">60</span>, <span class="co"># by-item random slope for exp</span>
  <span class="no">icor</span>         <span class="kw">=</span> <span class="fl">0.2</span>, <span class="co"># by-item random effect correlation</span>
  <span class="no">S0s_sd</span>       <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># by-subject random intercept sd</span>
  <span class="no">Scat_sd</span>      <span class="kw">=</span>  <span class="fl">40</span>, <span class="co"># by-subject random slope sd for category</span>
  <span class="no">Sexp_sd</span>      <span class="kw">=</span>  <span class="fl">80</span>, <span class="co"># by-subject random slope sd for exp</span>
  <span class="no">Scat_exp_sd</span>  <span class="kw">=</span>  <span class="fl">80</span>, <span class="co"># by-subject random slope sd for category*exp</span>
  <span class="co"># by-subject random effect correlations</span>
  <span class="no">scor</span>         <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.3</span>, <span class="fl">.3</span>, <span class="fl">.3</span>,   <span class="co"># S0s  * cat, exp, tc</span>
                       <span class="fl">.1</span>, <span class="fl">.1</span>,   <span class="co"># cat  *      exp, tc</span>
                           <span class="fl">.1</span>),  <span class="co"># exp *            tc</span>
  <span class="no">err_sd</span>       <span class="kw">=</span> <span class="fl">200</span>   <span class="co"># residual (error) sd</span>
) {

  <span class="co"># simulate items</span>
  <span class="no">items</span> <span class="kw">&lt;-</span> <span class="kw pkg">faux</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/faux/man/sim_design.html">sim_design</a></span>(
    <span class="kw">within</span>  <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">components</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"I0i"</span>, <span class="st">"Iexp"</span>)),
    <span class="kw">between</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">category</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ingroup"</span>, <span class="st">"outgroup"</span>)),
    <span class="kw">n</span> <span class="kw">=</span> <span class="no">nitem</span>,
    <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">I0i</span> <span class="kw">=</span> <span class="no">I0i_sd</span>,
                    <span class="kw">Iexp</span> <span class="kw">=</span> <span class="no">Iexp_sd</span>),
    <span class="kw">r</span> <span class="kw">=</span> <span class="no">icor</span>,
    <span class="kw">id</span> <span class="kw">=</span> <span class="st">"item_id"</span>,
    <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  )

  <span class="co"># simulate subjects</span>
  <span class="no">subjects</span> <span class="kw">&lt;-</span> <span class="kw pkg">faux</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/faux/man/sim_design.html">sim_design</a></span>(
    <span class="kw">within</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">components</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"S0s"</span>, <span class="st">"Scat"</span>, <span class="st">"Sexp"</span>, <span class="st">"Scatexp"</span>)),
    <span class="kw">n</span> <span class="kw">=</span> <span class="no">nsubj</span>,
    <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">S0s</span>  <span class="kw">=</span> <span class="no">S0s_sd</span>,
           <span class="kw">Scat</span> <span class="kw">=</span> <span class="no">Scat_sd</span>,
           <span class="kw">Sexp</span> <span class="kw">=</span> <span class="no">Sexp_sd</span>,
           <span class="kw">Scatexp</span>  <span class="kw">=</span> <span class="no">Scat_exp_sd</span>),
    <span class="kw">r</span> <span class="kw">=</span> <span class="no">scor</span>,
    <span class="kw">id</span> <span class="kw">=</span> <span class="st">"subj_id"</span>,
    <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>
  )

  <span class="co"># simulate trials</span>
  <span class="no">dat_sim</span> <span class="kw">&lt;-</span> <span class="fu">crossing</span>(
    <span class="kw">subj_id</span> <span class="kw">=</span> <span class="no">subjects</span>$<span class="no">subj_id</span>,
    <span class="kw">item_id</span> <span class="kw">=</span> <span class="no">items</span>$<span class="no">item_id</span>,
    <span class="kw">expression</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"happy"</span>, <span class="st">"angry"</span>), <span class="kw">ordered</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  ) <span class="kw">%&gt;%</span>
    <span class="fu">inner_join</span>(<span class="no">subjects</span>, <span class="st">"subj_id"</span>) <span class="kw">%&gt;%</span>
    <span class="fu">inner_join</span>(<span class="no">items</span>, <span class="st">"item_id"</span>) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">exp</span> <span class="kw">=</span> <span class="fu">recode</span>(<span class="no">expression</span>, <span class="st">"happy"</span> <span class="kw">=</span> -<span class="fl">0.5</span>, <span class="st">"angry"</span> <span class="kw">=</span> <span class="fl">0.5</span>),
           <span class="kw">cat</span> <span class="kw">=</span> <span class="fu">recode</span>(<span class="no">category</span>, <span class="st">"ingroup"</span> <span class="kw">=</span> -<span class="fl">0.5</span>, <span class="st">"outgroup"</span> <span class="kw">=</span> +<span class="fl">0.5</span>),
           <span class="kw">trial_i</span>    <span class="kw">=</span> <span class="no">b0</span> + <span class="no">I0i</span> +  <span class="no">S0s</span>,
           <span class="kw">trial_cat</span>  <span class="kw">=</span> <span class="no">b_cat</span> + <span class="no">Scat</span>,
           <span class="kw">trial_exp</span>  <span class="kw">=</span> <span class="no">b_exp</span> + <span class="no">Iexp</span> + <span class="no">Sexp</span>,
           <span class="kw">trial_ct</span>   <span class="kw">=</span> <span class="no">b_cat_exp</span> + <span class="no">Scatexp</span>,
           <span class="kw">err</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">.</span>), <span class="kw">mean</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="no">err_sd</span>),
           <span class="kw">RT</span> <span class="kw">=</span> <span class="no">trial_i</span> +
             (<span class="no">trial_cat</span>*<span class="no">cat</span>) +
             (<span class="no">trial_exp</span>*<span class="no">exp</span>) +
             (<span class="no">trial_ct</span>*<span class="no">cat</span>*<span class="no">exp</span>) + <span class="no">err</span>)

  <span class="no">dat_sim</span>
}</pre></body></html></div>
<p>Plot your data to double-check it looks like you expect.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">dat_sim</span> <span class="kw">&lt;-</span> <span class="fu">ext_sim_data</span>()

<span class="fu">ggplot</span>(<span class="no">dat_sim</span>, <span class="fu">aes</span>(<span class="no">expression</span>, <span class="no">RT</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">category</span>)) +
  <span class="fu">geom_boxplot</span>(<span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">position</span> <span class="kw">=</span> <span class="fu">position_dodge</span>(<span class="kw">width</span> <span class="kw">=</span> <span class="fl">0.9</span>))</pre></body></html></div>
<p><img src="appendix2_extended_example_files/figure-html/unnamed-chunk-3-1.png" width="100%"></p>
</div>
<div id="analyse-data" class="section level3">
<h3 class="hasAnchor">
<a href="#analyse-data" class="anchor"></a>Analyse Data</h3>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ext_sim_func</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">...</span>) {

  <span class="no">dat_sim</span> <span class="kw">&lt;-</span> <span class="fu">ext_sim_data</span>(<span class="no">...</span>)

  <span class="no">mod_sim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">RT</span> ~ <span class="fl">1</span> + <span class="no">cat</span>*<span class="no">exp</span> +
                    (<span class="fl">1</span> + <span class="no">exp</span> <span class="kw">|</span> <span class="no">item_id</span>) +
                    (<span class="fl">1</span> + <span class="no">cat</span>*<span class="no">exp</span> <span class="kw">|</span> <span class="no">subj_id</span>),
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">dat_sim</span>, <span class="kw">REML</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

  <span class="kw pkg">broom.mixed</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/broom.mixed/man/reexports.html">tidy</a></span>(<span class="no">mod_sim</span>)
}</pre></body></html></div>
<p>Run the function once with default parameters.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu">ext_sim_func</span>()</pre></body></html></div>
<pre><code>## # A tibble: 18 x 8
##    effect   group  term             estimate std.error statistic    df   p.value
##    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 fixed    &lt;NA&gt;   (Intercept)      792.          15.4     51.3  118.   1.14e-82
##  2 fixed    &lt;NA&gt;   cat               46.7         23.2      2.01  51.2  4.96e- 2
##  3 fixed    &lt;NA&gt;   exp              -22.6         11.8     -1.92 106.   5.77e- 2
##  4 fixed    &lt;NA&gt;   cat:exp           97.0         19.8      4.90  72.6  5.68e- 6
##  5 ran_pars subj_â€¦ sd__(Intercept)  104.          NA       NA     NA   NA       
##  6 ran_pars subj_â€¦ cor__(Interceptâ€¦   0.175       NA       NA     NA   NA       
##  7 ran_pars subj_â€¦ cor__(Interceptâ€¦   0.181       NA       NA     NA   NA       
##  8 ran_pars subj_â€¦ cor__(Interceptâ€¦   0.481       NA       NA     NA   NA       
##  9 ran_pars subj_â€¦ sd__cat           42.0         NA       NA     NA   NA       
## 10 ran_pars subj_â€¦ cor__cat.exp      -0.0391      NA       NA     NA   NA       
## 11 ran_pars subj_â€¦ cor__cat.cat:exp   0.0991      NA       NA     NA   NA       
## 12 ran_pars subj_â€¦ sd__exp           79.9         NA       NA     NA   NA       
## 13 ran_pars subj_â€¦ cor__exp.cat:exp   0.200       NA       NA     NA   NA       
## 14 ran_pars subj_â€¦ sd__cat:exp       96.1         NA       NA     NA   NA       
## 15 ran_pars item_â€¦ sd__(Intercept)   79.5         NA       NA     NA   NA       
## 16 ran_pars item_â€¦ cor__(Interceptâ€¦   0.338       NA       NA     NA   NA       
## 17 ran_pars item_â€¦ sd__exp           54.4         NA       NA     NA   NA       
## 18 ran_pars Residâ€¦ sd__Observation  199.          NA       NA     NA   NA</code></pre>
</div>
<div id="power-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#power-analysis" class="anchor"></a>Power Analysis</h2>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">reps</span> <span class="kw">&lt;-</span> <span class="fl">20</span>

<span class="co"># runs each rep, combines them into one data frame,</span>
<span class="co"># and then writes the results to a file</span>
<span class="co"># if this crashes, you've lost everything</span>
<span class="co"># sims &lt;- purrr::map_df(1:reps, ~ext_sim_func())</span>
<span class="co"># write_csv(sims, "sims/ext_sims.csv")</span>

<span class="co"># write to file after each rep; more robust against crashes</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="no">reps</span>, {
  <span class="co"># run 1 rep of the simulation</span>
  <span class="no">sim</span> <span class="kw">&lt;-</span> <span class="fu">ext_sim_func</span>()
  <span class="co"># add column for date/time</span>
  <span class="no">sim</span>$<span class="no">date</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>(), <span class="st">"%Y-%m-%d %H:%M"</span>)
  <span class="co"># check if you need to write the header</span>
  <span class="no">append</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="st">"sims/ext_sims.csv"</span>)
  <span class="co"># write to a file</span>
  <span class="fu">write_csv</span>(<span class="no">sim</span>, <span class="st">"sims/ext_sims.csv"</span>, <span class="kw">append</span> <span class="kw">=</span> <span class="no">append</span>)
})</pre></body></html></div>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">sims</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"sims/ext_sims.csv"</span>, <span class="kw">col_types</span> <span class="kw">=</span> <span class="fu">cols</span>(
  <span class="co"># makes sure plots display in this order</span>
  <span class="kw">group</span> <span class="kw">=</span> <span class="fu">col_factor</span>(<span class="kw">ordered</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">term</span> <span class="kw">=</span> <span class="fu">col_factor</span>(<span class="kw">ordered</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
))</pre></body></html></div>
<p>You can use these data to calculate power for each fixed effect or plot the distribution of your fixed or random effects.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># calculate mean estimates and power for specified alpha</span>
<span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fl">0.05</span>

<span class="no">sims</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">effect</span> <span class="kw">==</span> <span class="st">"fixed"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">term</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(
    <span class="kw">mean_estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>),
    <span class="kw">mean_se</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">std.error</span>),
    <span class="kw">power</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">p.value</span> <span class="kw">&lt;</span> <span class="no">alpha</span>),
    <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">"drop"</span>
  )</pre></body></html></div>
<pre><code>## # A tibble: 4 x 4
##   term        mean_estimate mean_se power
##   &lt;ord&gt;               &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 (Intercept)        799.      15.3  1   
## 2 cat                 53.4     23.5  0.7 
## 3 exp                 -6.97    12.5  0.05
## 4 cat:exp             60.7     20.7  0.75</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">sim_stats</span> <span class="kw">&lt;-</span> <span class="no">sims</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">effect</span> <span class="kw">==</span> <span class="st">"fixed"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">term</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(
    <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>),
    <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">"drop"</span>
  )

<span class="no">sims</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">effect</span> <span class="kw">==</span> <span class="st">"fixed"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() +
  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="no">estimate</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">..count..</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">term</span>),
               <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu">geom_vline</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">sim_stats</span>, <span class="fu">aes</span>(<span class="kw">xintercept</span> <span class="kw">=</span> <span class="no">value</span>),
             <span class="kw">color</span> <span class="kw">=</span> <span class="st">"grey40"</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu">facet_wrap</span>(~<span class="no">term</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_x"</span>) +
  <span class="fu">theme_bw</span>()</pre></body></html></div>
<div class="figure">
<img src="appendix2_extended_example_files/figure-html/unnamed-chunk-9-1.png" alt="Distribution of fixed effects across simulations" width="100%"><p class="caption">
Distribution of fixed effects across simulations
</p>
</div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">sim_stats</span> <span class="kw">&lt;-</span> <span class="no">sims</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">effect</span> <span class="kw">==</span> <span class="st">"ran_pars"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">group</span>, <span class="no">term</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>),
            <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">"drop"</span>)

<span class="no">sims</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">effect</span> <span class="kw">==</span> <span class="st">"ran_pars"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="no">estimate</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">group</span>)) +
  <span class="fu">geom_density</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu">geom_vline</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">sim_stats</span>, <span class="fu">aes</span>(<span class="kw">xintercept</span> <span class="kw">=</span> <span class="no">value</span>),
             <span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu">facet_wrap</span>(~<span class="no">group</span>*<span class="no">term</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free"</span>) +
  <span class="fu">theme_bw</span>()</pre></body></html></div>
<div class="figure">
<img src="appendix2_extended_example_files/figure-html/unnamed-chunk-10-1.png" alt="Distribution of random effects across simulations" width="100%"><p class="caption">
Distribution of random effects across simulations
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lisa DeBruine, Dale Barr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
