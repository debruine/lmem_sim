<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Appendix 1c: Sensitivity Analysis â€¢ lmem.sim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Appendix 1c: Sensitivity Analysis">
<meta property="og:description" content="lmem.sim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lmem.sim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/appendix1_example_code.html">Appendix 1: Example Code</a>
    </li>
    <li>
      <a href="../articles/appendix1b_example_code.html">Appendix 1b: Example Code (no tidyverse)</a>
    </li>
    <li>
      <a href="../articles/appendix1c_sensitivity.html">Appendix 1c: Sensitivity Analysis</a>
    </li>
    <li>
      <a href="../articles/appendix2_extended_example.html">Appendix 2: Extended Example</a>
    </li>
    <li>
      <a href="../articles/appendix3_binomial.html">Appendix 3: Binomial Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="appendix1c_sensitivity_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Appendix 1c: Sensitivity Analysis</h1>
            <h3 class="subtitle">Understanding mixed effects models through data simulation</h3>
                        <h4 class="author">Lisa M. DeBruine &amp; Dale J. Barr</h4>
            
      
      
      <div class="hidden name"><code>appendix1c_sensitivity.Rmd</code></div>

    </div>

    
    
<div id="required-software" class="section level3">
<h3 class="hasAnchor">
<a href="#required-software" class="anchor"></a>Required software</h3>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># load required packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"lme4"</span>)        <span class="co"># model specification / estimation</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"lmerTest"</span>)    <span class="co"># deriving p-values from lmer</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"broom.mixed"</span>) <span class="co"># extracting data from model fits </span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"faux"</span>)        <span class="co"># generate correlated values</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"tidyverse"</span>)   <span class="co"># data wrangling and visualisation</span>

<span class="co"># ensure this script returns the same results on each run</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">8675309</span>)
<span class="fu"><a href="https://rdrr.io/pkg/faux/man/faux_options.html">faux_options</a></span>(<span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
</div>
<div id="data-simulation-function" class="section level3">
<h3 class="hasAnchor">
<a href="#data-simulation-function" class="anchor"></a>Data simulation function</h3>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># set up the custom data simulation function</span>
<span class="no">my_sim_data</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(
  <span class="no">tau_n</span>   <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># number of subjects</span>
  <span class="no">omega_n</span> <span class="kw">=</span>  <span class="fl">25</span>,  <span class="co"># number of items per category</span>
  <span class="no">b0</span>      <span class="kw">=</span> <span class="fl">800</span>, <span class="co"># grand mean</span>
  <span class="no">b1</span>      <span class="kw">=</span>  <span class="fl">50</span>, <span class="co"># effect of category</span>
  <span class="no">omega_0</span> <span class="kw">=</span>  <span class="fl">80</span>, <span class="co"># by-item random intercept sd</span>
  <span class="no">tau_0</span>   <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># by-subject random intercept sd</span>
  <span class="no">tau_1</span>   <span class="kw">=</span>  <span class="fl">40</span>, <span class="co"># by-subject random slope sd</span>
  <span class="no">tau_r</span>   <span class="kw">=</span> <span class="fl">0.2</span>, <span class="co"># correlation between intercept and slope</span>
  <span class="no">sigma</span>   <span class="kw">=</span> <span class="fl">200</span>  <span class="co"># residual (standard deviation)</span>
  ) {

  <span class="co"># simulate a sample of items</span>
  <span class="no">items</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="kw">item_id</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">omega_n</span>*<span class="fl">2</span>),
    <span class="kw">category</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ingroup"</span>, <span class="st">"outgroup"</span>), <span class="no">omega_n</span>),
    <span class="kw">O0i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">omega_n</span>*<span class="fl">2</span>, <span class="fl">0</span>, <span class="no">omega_0</span>)
  )

  <span class="co"># effect code category</span>
  <span class="no">items</span>$<span class="no">cat</span> <span class="kw">&lt;-</span> <span class="fu">recode</span>(<span class="no">items</span>$<span class="no">category</span>,
                      <span class="st">"ingroup"</span> <span class="kw">=</span> -<span class="fl">0.5</span>,
                      <span class="st">"outgroup"</span> <span class="kw">=</span> <span class="fl">0.5</span>)

  <span class="co"># simulate a sample of subjects</span>
  <span class="no">subjects</span> <span class="kw">&lt;-</span> <span class="kw pkg">faux</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/faux/man/rnorm_multi.html">rnorm_multi</a></span>(
    <span class="kw">n</span> <span class="kw">=</span> <span class="no">tau_n</span>,
    <span class="kw">mu</span> <span class="kw">=</span> <span class="fl">0</span>,
    <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">tau_0</span>, <span class="no">tau_1</span>),
    <span class="kw">r</span> <span class="kw">=</span> <span class="no">tau_r</span>,
    <span class="kw">varnames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"T0s"</span>, <span class="st">"T1s"</span>)
  )
  <span class="no">subjects</span>$<span class="no">subj_id</span> <span class="kw">&lt;-</span> <span class="fl">1</span>:<span class="no">tau_n</span>

  <span class="co"># simulate trials</span>
  <span class="no">dat_sim</span> <span class="kw">&lt;-</span> <span class="fu">crossing</span>(<span class="kw">subj_id</span> <span class="kw">=</span> <span class="no">subjects</span>$<span class="no">subj_id</span>,
                   <span class="kw">item_id</span> <span class="kw">=</span> <span class="no">items</span>$<span class="no">item_id</span>)  <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">sigma</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">.</span>), <span class="kw">mean</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="no">sigma</span>)) <span class="kw">%&gt;%</span>
    <span class="fu">inner_join</span>(<span class="no">subjects</span>, <span class="st">"subj_id"</span>) <span class="kw">%&gt;%</span>
    <span class="fu">inner_join</span>(<span class="no">items</span>, <span class="st">"item_id"</span>) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">RT</span> <span class="kw">=</span> <span class="no">b0</span> + <span class="no">O0i</span> + <span class="no">T0s</span> + (<span class="no">b1</span> + <span class="no">T1s</span>) * <span class="no">cat</span> + <span class="no">sigma</span>) <span class="kw">%&gt;%</span>
    <span class="fu">select</span>(<span class="no">subj_id</span>, <span class="no">item_id</span>, <span class="no">category</span>, <span class="no">cat</span>, <span class="no">RT</span>)

  <span class="no">dat_sim</span>
}</pre></body></html></div>
</div>
<div id="power-calculation-function" class="section level2">
<h2 class="hasAnchor">
<a href="#power-calculation-function" class="anchor"></a>Power calculation function</h2>
<p>The power calculation function is slightly more complicated than the one for the basic example. Since sensitivity analyses usually push analyses into parameter spaces where the models produce warnings, weâ€™re capturing the warnings and adding them to the results table. Weâ€™re also adding the parameters to the results table so you can group by the different parameter options when visualising the results.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># set up the power function</span>
<span class="no">my_lmer_power</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">filename</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="no">...</span>) {
  <span class="co"># ... is a shortcut that forwards any arguments to my_sim_data()</span>
  <span class="no">dat_sim</span> <span class="kw">&lt;-</span> <span class="fu">my_sim_data</span>(<span class="no">...</span>)

  <span class="co"># run lmer and capture any warnings</span>
  <span class="no">ww</span> <span class="kw">&lt;-</span> <span class="st">""</span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(
    <span class="no">mod_sim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/conditions.html">withCallingHandlers</a></span>({
      <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">RT</span> ~ <span class="no">cat</span> + (<span class="fl">1</span> <span class="kw">|</span> <span class="no">item_id</span>) + (<span class="fl">1</span> + <span class="no">cat</span> <span class="kw">|</span> <span class="no">subj_id</span>),
                  <span class="no">dat_sim</span>, <span class="kw">REML</span> <span class="kw">=</span> <span class="fl">FALSE</span>)},
      <span class="kw">warning</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">w</span>) { <span class="no">ww</span> <span class="kw">&lt;&lt;-</span> <span class="no">w</span>$<span class="no">message</span> }
    )
  ))

  <span class="co"># get results table and add rep number and any warnings</span>
  <span class="no">sim_results</span> <span class="kw">&lt;-</span> <span class="kw pkg">broom.mixed</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/broom.mixed/man/reexports.html">tidy</a></span>(<span class="no">mod_sim</span>) <span class="kw">%&gt;%</span>
    <span class="fu">mutate</span>(<span class="kw">warnings</span> <span class="kw">=</span> <span class="no">ww</span>)

  <span class="co"># add columns for the specified parameters</span>
  <span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">...</span>)
  <span class="kw">for</span> (<span class="no">name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">params</span>)) {
    <span class="no">sim_results</span>[<span class="no">name</span>] <span class="kw">&lt;-</span> <span class="no">params</span>[<span class="no">name</span>]
  }

  <span class="co"># append the results to a file if filename is set</span>
  <span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">filename</span>)) {
    <span class="no">append</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">filename</span>) <span class="co"># append if the file exists</span>
    <span class="fu">write_csv</span>(<span class="no">sim_results</span>, <span class="no">filename</span>, <span class="kw">append</span> <span class="kw">=</span> <span class="no">append</span>)
  }

  <span class="no">sim_results</span>
}</pre></body></html></div>
<div id="example-1-effect-size" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1-effect-size" class="anchor"></a>Example 1: Effect size</h3>
<p>Set up a data table with all of the parameter combinations you want to test. For example, the code below sets up 100 replications for effects of category ranging from 0 to 100 ms in steps of 10. All of the other parameters are default, but weâ€™re specifying them anyways so they are saved in the results table.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">filename1</span> <span class="kw">&lt;-</span> <span class="st">"sims/sens1.csv"</span>
<span class="no">nreps</span> <span class="kw">&lt;-</span> <span class="fl">100</span> <span class="co"># number of replications per parameter combo</span>

<span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu">crossing</span>(
  <span class="kw">rep</span>    <span class="kw">=</span> <span class="fl">1</span>:<span class="no">nreps</span>,
  <span class="kw">tau_n</span>  <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># number of subjects</span>
  <span class="kw">omega_n</span> <span class="kw">=</span>  <span class="fl">25</span>, <span class="co"># number of items</span>
  <span class="kw">b0</span>      <span class="kw">=</span> <span class="fl">800</span>, <span class="co"># grand mean</span>
  <span class="kw">b1</span>      <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">100</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">10</span>), <span class="co"># effect of category</span>
  <span class="kw">omega_0</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># by-item random intercept sd</span>
  <span class="kw">tau_0</span>   <span class="kw">=</span>  <span class="fl">80</span>, <span class="co"># by-subject random intercept sd</span>
  <span class="kw">tau_1</span>   <span class="kw">=</span>  <span class="fl">40</span>, <span class="co"># by-subject random slope sd</span>
  <span class="kw">tau_r</span>   <span class="kw">=</span> <span class="fl">0.2</span>, <span class="co"># correlation between intercept and slope</span>
  <span class="kw">sigma</span>   <span class="kw">=</span> <span class="fl">200</span>  <span class="co"># residual (standard deviation)</span>
) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">rep</span>) <span class="co"># remove rep column</span></pre></body></html></div>
<p>This table has 1100 rows, so will run 1100 simulations below. The code below saves the results to a named file or appends them to the file if one exists already. Run a small number of replicates to start and add to it after youâ€™re sure your code works and you have an idea how long it takes.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">filename1</span>)) {
  <span class="co"># run a simulation for each row of params</span>
  <span class="co"># and save to a file on each rep</span>
  <span class="no">sims1</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_df</a></span>(<span class="no">params</span>, <span class="no">my_lmer_power</span>, <span class="kw">filename</span> <span class="kw">=</span> <span class="no">filename1</span>)
}

<span class="co"># read saved simulation data</span>
<span class="co"># NB: col_types is set for warnings in case </span>
<span class="co">#     the first 1000 rows don't have any</span>
<span class="no">ct</span> <span class="kw">&lt;-</span> <span class="fu">cols</span>(<span class="kw">warnings</span> <span class="kw">=</span> <span class="fu">col_character</span>())
<span class="no">sims1</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="no">filename1</span>, <span class="kw">col_types</span> <span class="kw">=</span> <span class="no">ct</span>)</pre></body></html></div>
<p>The chunk above will just read the saved data from the named file, if it exists. The code below calculates the mean estimates and power for each group. Make sure to set the <code>group_by</code> to the parameters you altered above.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># calculate mean estimates and power for specified alpha</span>
<span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fl">0.05</span>

<span class="no">power1</span> <span class="kw">&lt;-</span> <span class="no">sims1</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">effect</span> <span class="kw">==</span> <span class="st">"fixed"</span>, <span class="no">term</span> <span class="kw">==</span> <span class="st">"cat"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">term</span>, <span class="no">b1</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(
    <span class="kw">mean_estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>),
    <span class="kw">mean_se</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">std.error</span>),
    <span class="kw">power</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">p.value</span> <span class="kw">&lt;</span> <span class="no">alpha</span>),
    <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">"drop"</span>
  )

<span class="no">power1</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="no">b1</span>, <span class="no">power</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu">geom_smooth</span>(<span class="kw">se</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">1</span>) +
  <span class="fu">scale_x_continuous</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"Effect of category in ms (b1)"</span>,
                     <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">10</span>))</pre></body></html></div>
<p><img src="appendix1c_sensitivity_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="example-2-number-of-subjects-and-items" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2-number-of-subjects-and-items" class="anchor"></a>Example 2: Number of subjects and items</h3>
<p>The code below sets up 50 replications for each of 20 combinations of 10 to 50 subjects (by steps of 10) and 10 to 25 stimuli (by steps of 5).</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">filename2</span> <span class="kw">&lt;-</span> <span class="st">"sims/sens2.csv"</span>
<span class="no">nreps</span> <span class="kw">&lt;-</span> <span class="fl">50</span> <span class="co"># number of replications per parameter combo</span>

<span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu">crossing</span>(
  <span class="kw">rep</span>     <span class="kw">=</span> <span class="fl">1</span>:<span class="no">nreps</span>,
  <span class="kw">tau_n</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">10</span>, <span class="fl">50</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">10</span>),
  <span class="kw">omega_n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">10</span>, <span class="fl">25</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">5</span>),
  <span class="kw">b0</span>      <span class="kw">=</span> <span class="fl">800</span>, <span class="co"># grand mean</span>
  <span class="kw">b1</span>      <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># effect of category</span>
  <span class="kw">omega_0</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="co"># by-item random intercept sd</span>
  <span class="kw">tau_0</span>   <span class="kw">=</span>  <span class="fl">80</span>, <span class="co"># by-subject random intercept sd</span>
  <span class="kw">tau_1</span>   <span class="kw">=</span>  <span class="fl">40</span>, <span class="co"># by-subject random slope sd</span>
  <span class="kw">tau_r</span>   <span class="kw">=</span> <span class="fl">0.2</span>, <span class="co"># correlation between intercept and slope</span>
  <span class="kw">sigma</span>   <span class="kw">=</span> <span class="fl">200</span>  <span class="co"># residual (standard deviation)</span>
) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">rep</span>) <span class="co"># remove rep column</span></pre></body></html></div>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">filename2</span>)) {
  <span class="co"># run a simulation for each row of params</span>
  <span class="co"># and save to a file on each rep</span>
  <span class="no">sims2</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_df</a></span>(<span class="no">params</span>, <span class="no">my_lmer_power</span>, <span class="kw">filename</span> <span class="kw">=</span> <span class="no">filename2</span>)
}

<span class="co"># read saved simulation data</span>
<span class="no">ct</span> <span class="kw">&lt;-</span> <span class="fu">cols</span>(<span class="kw">warnings</span> <span class="kw">=</span> <span class="fu">col_character</span>())
<span class="no">sims2</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="no">filename2</span>, <span class="kw">col_types</span> <span class="kw">=</span> <span class="no">ct</span>)</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># calculate mean estimates and power for specified alpha</span>
<span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fl">0.05</span>

<span class="no">power2</span> <span class="kw">&lt;-</span> <span class="no">sims2</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">effect</span> <span class="kw">==</span> <span class="st">"fixed"</span>, <span class="no">term</span> <span class="kw">==</span> <span class="st">"cat"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">term</span>, <span class="no">tau_n</span>, <span class="no">omega_n</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(
    <span class="kw">mean_estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>),
    <span class="kw">mean_se</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">std.error</span>),
    <span class="kw">power</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">p.value</span> <span class="kw">&lt;</span> <span class="no">alpha</span>),
    <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">"drop"</span>
  )

<span class="no">power2</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="no">tau_n</span>, <span class="no">omega_n</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">power</span>)) +
  <span class="fu">geom_tile</span>(<span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="kw">label</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">power</span>, <span class="fl">2</span>)), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"white"</span>) +
  <span class="fu">scale_x_continuous</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"Number of subjects (nsubj)"</span>,
                     <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">10</span>)) +
  <span class="fu">scale_y_continuous</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"Number of items (nitem)"</span>,
                     <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">5</span>, <span class="fl">25</span>, <span class="fl">5</span>)) +
  <span class="fu">scale_fill_viridis_c</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>))</pre></body></html></div>
<p><img src="appendix1c_sensitivity_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div id="example-3-random-intercept-sds" class="section level3">
<h3 class="hasAnchor">
<a href="#example-3-random-intercept-sds" class="anchor"></a>Example 3: Random intercept SDs</h3>
<p>The code below sets up 50 replications for designs with 50 subjects, 10 items, and by-item and by-subject random intercept SDs ranging from 20 to 100 in steps of 20.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">filename3</span> <span class="kw">&lt;-</span> <span class="st">"sims/sens3.csv"</span>
<span class="no">nreps</span> <span class="kw">&lt;-</span> <span class="fl">50</span> <span class="co"># number of replications per parameter combo</span>

<span class="no">params</span> <span class="kw">&lt;-</span> <span class="fu">crossing</span>(
  <span class="kw">rep</span>     <span class="kw">=</span> <span class="fl">1</span>:<span class="no">nreps</span>,
  <span class="kw">tau_n</span>   <span class="kw">=</span>  <span class="fl">50</span>, <span class="co"># number of subjects</span>
  <span class="kw">omega_n</span> <span class="kw">=</span>  <span class="fl">10</span>, <span class="co"># number of items</span>
  <span class="kw">b0</span>      <span class="kw">=</span> <span class="fl">800</span>, <span class="co"># grand mean</span>
  <span class="kw">b1</span>      <span class="kw">=</span>  <span class="fl">50</span>, <span class="co"># effect of category</span>
  <span class="kw">omega_0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">20</span>, <span class="fl">100</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">20</span>), <span class="co"># by-item random intercept sd</span>
  <span class="kw">tau_0</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">20</span>, <span class="fl">100</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">20</span>), <span class="co"># by-subject random intercept sd</span>
  <span class="kw">tau_1</span>   <span class="kw">=</span>  <span class="fl">40</span>, <span class="co"># by-subject random slope sd</span>
  <span class="kw">tau_r</span>   <span class="kw">=</span> <span class="fl">0.2</span>, <span class="co"># correlation between intercept and slope</span>
  <span class="kw">sigma</span>   <span class="kw">=</span> <span class="fl">200</span>  <span class="co"># residual (standard deviation)</span>
) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">rep</span>) <span class="co"># remove rep column</span></pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">filename3</span>)) {
  <span class="co"># run a simulation for each row of params</span>
  <span class="co"># and save to a file on each rep</span>
  <span class="no">sims3</span> <span class="kw">&lt;-</span> <span class="kw pkg">purrr</span><span class="kw ns">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap_df</a></span>(<span class="no">params</span>, <span class="no">my_lmer_power</span>, <span class="kw">filename</span> <span class="kw">=</span> <span class="no">filename3</span>)
}

<span class="co"># read saved simulation data</span>
<span class="no">ct</span> <span class="kw">&lt;-</span> <span class="fu">cols</span>(<span class="kw">warnings</span> <span class="kw">=</span> <span class="fu">col_character</span>())
<span class="no">sims3</span> <span class="kw">&lt;-</span> <span class="fu">read_csv</span>(<span class="no">filename3</span>, <span class="kw">col_types</span> <span class="kw">=</span> <span class="no">ct</span>)</pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># calculate mean estimates and power for specified alpha</span>
<span class="no">alpha</span> <span class="kw">&lt;-</span> <span class="fl">0.05</span>

<span class="no">power3</span> <span class="kw">&lt;-</span> <span class="no">sims3</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">effect</span> <span class="kw">==</span> <span class="st">"fixed"</span>, <span class="no">term</span> <span class="kw">==</span> <span class="st">"cat"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">term</span>, <span class="no">omega_0</span>, <span class="no">tau_0</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(
    <span class="kw">mean_estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>),
    <span class="kw">mean_se</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">std.error</span>),
    <span class="kw">power</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">p.value</span> <span class="kw">&lt;</span> <span class="no">alpha</span>),
    <span class="kw">.groups</span> <span class="kw">=</span> <span class="st">"drop"</span>
  )

<span class="no">power3</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="no">omega_0</span>, <span class="no">tau_0</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">power</span>)) +
  <span class="fu">geom_tile</span>(<span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="kw">label</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">power</span>, <span class="fl">2</span>)), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"white"</span>) +
  <span class="fu">scale_x_continuous</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"By-item random intercept SD (omega_0)"</span>,
                     <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">20</span>, <span class="fl">100</span>, <span class="fl">20</span>)) +
  <span class="fu">scale_y_continuous</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"By-subject random intercept SD (tau_0)"</span>,
                     <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">20</span>, <span class="fl">100</span>, <span class="fl">20</span>)) +
  <span class="fu">scale_fill_viridis_c</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>))</pre></body></html></div>
<p><img src="appendix1c_sensitivity_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lisa DeBruine, Dale Barr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
